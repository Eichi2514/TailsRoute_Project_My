<th:block th:replace="usr/common/head"/>
<head>
    <title>상세보기</title>
    <link rel="stylesheet" href="/resource/css/article.css"/>
    <script>
        const params = {};
        params.id = [[${param.id}]];
        params.memberId = [[${loginedMemberId}]];

        let isAlreadyAddGoodRp = [[${isAlreadyAddGoodRp}]];
        let isAlreadyAddBadRp = [[${isAlreadyAddBadRp}]];
    </script>
    <script src="/resource/js/article.js"></script>
</head>

<section class="mt-24 text-xl px-4">
    <div class="mx-auto">
        <!-- 타임리프 사용 -->
        <table class="table" border="1" cellspacing="0" cellpadding="5">
            <tbody>
            <tr>
                <th>ID</th>
                <td th:text="${article.id}"></td>
            </tr>
            <tr>
                <th>Registration Date</th>
                <td th:text="${#dates.format(article.regDate, 'yyyy-MM-dd')}"></td>
            </tr>
            <tr>
                <th>Modified date</th>
                <td th:text="${article.updateDate}"></td>
            </tr>
            <tr>
                <th>BoardId</th>
                <td th:text="${article.boardId}"></td>
            </tr>
            <tr>
                <th>Writer</th>
                <td th:text="${article.extra__writer}"></td>
            </tr>
            <tr>
                <th>Like</th>
                <td id="likeCount" th:text="${article.goodReactionPoint}"></td>
            </tr>
            <tr>
                <th>Dislike</th>
                <td id="DislikeCount" th:text="${article.badReactionPoint}"></td>
            </tr>
            <tr>
                <th>LIKE / Dislike</th>
                <td>
                    <button id="likeButton" class="btn btn-outline btn-success"
                            th:onclick="'doGoodReaction(' + ${param.id} + ')'">
                        👍 LIKE <span class="likeCount" th:text="${article.goodReactionPoint}"></span>
                    </button>
                    <button id="DislikeButton" class="btn btn-outline btn-error"
                            th:onclick="'doBadReaction(' + ${param.id} + ')'">
                        👎 DISLIKE <span class="DislikeCount" th:text="${article.badReactionPoint}"></span>
                    </button>
                </td>
            </tr>
            <tr>
                <th>Views</th>
                <td><span class="article-detail__hit-count" th:text="${article.hitCount}"></span></td>
            </tr>
            <tr>
                <th>Title</th>
                <td th:text="${article.title}"></td>
            </tr>
            <tr>
                <th>Attached Image</th>
                <td>
                    <img class="mx-auto rounded-xl"
                         th:src="|${'/common/genFile/file/article/' + article.id + '/extra/Img/1'}|"
                         th:if="${article.id != null}"/>
                </td>
            </tr>
            <tr>
                <th>Body</th>
                <td>
                    <div th:utext="${article.body}"></div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<!-- 댓글 리스트 -->
<section class="mt-24 text-xl px-4">
    <th:if test="${isLogined}">
        <form th:action="@{/reply/doWrite}" method="POST" onsubmit="ReplyWrite__submit(this); return false;">
            <table class="table" border="1" cellspacing="0" cellpadding="5">
                <input type="hidden" name="relTypeCode" value="article"/>
                <input type="hidden" name="relId" th:value="${article.id}"/>
                <tr>
                    <th>댓글 내용 입력</th>
                    <td>
                        <textarea name="body" class="input input-bordered input-sm w-full max-w-xs"></textarea>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="text-center">
                        <button class="btn btn-outline">작성</button>
                    </td>
                </tr>
            </table>
        </form>
    </th:if>

    <th:if test="${isLogined}">
        댓글 작성을 위해 <a class="btn btn-outline btn-primary" th:href="${rq.loginUri}">로그인</a>이 필요합니다
    </th:if>

    <!-- 댓글 리스트 -->
    <div class="mx-auto">
        <table class="table" border="1" cellspacing="0" cellpadding="5">
            <thead>
            <tr>
                <th>Registration Date</th>
                <th>Updated Date</th>
                <th>Content</th>
                <th>Writer</th>
                <th>Edit</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="reply : ${replies}">
                <td th:text="${#dates.format(reply.regDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                <td th:text="${reply.updateDate}"></td>
                <td>
                    <div id="reply-${reply.id}" th:text="${reply.body}"></div>
                    <form id="modify-form-${reply.id}" style="display:none;"
                          onsubmit="doModifyReply(${reply.id}); return false;">
                        <input type="text" name="reply-text-${reply.id}" th:value="${reply.body}"/>
                    </form>
                </td>
                <td th:text="${reply.extra__writer}"></td>
                <td>
                    <button id="modify-btn-${reply.id}" class="btn btn-outline" onclick="toggleModifybtn(${reply.id})">
                        수정
                    </button>
                    <button id="save-btn-${reply.id}" class="btn btn-outline" style="display:none;"
                            onclick="doModifyReply(${reply.id})">저장
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</section>
