<div id="heads">
  <th:block th:replace="usr/common/head"/>
</div>
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map Search</title>
  <script async defer th:src="'https://maps.googleapis.com/maps/api/js?key=' + ${GOOGLE_ROUTE_API_KEY} + '&callback=initMap&libraries=places'"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    html {
      background-color: #FFFEF0;
    }
    .enterMap {
      margin-top: 70px;
      padding-left: 10px;
      padding-top: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #F2F2EB;
      width: 45%;
      height: 50px;
      margin-left: 3%;
      display: inline-block;
      position: absolute;
    }
    .WalkingSchedule, .WalkingTrail {
      margin-top: 130px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #F2F2EB;
      display: inline-block;
      width: 45%;
      height: 690px;
      margin-left: 3%;
    }
    .information {
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #F2F2EB;
      display: inline-block;
      width: 93%;
      height: 110px;
      margin-left: 3%;
    }
    /* íŒì—… ì°½ ìŠ¤íƒ€ì¼ */
    .modal {
      display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.4); /* ë°°ê²½ ì–´ë‘¡ê²Œ */
      overflow: auto;
    }

    .modal-content {
      background-color: #F2F2EB;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 600px;
      border-radius: 10px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
    #routePicture canvas {
      width: 200px;
      height: auto;
    }
    th{
      padding: 10px;
      text-align: center;
      border: 1px solid #ccc;
    }

    th#purchaseDateHeader,
    th#alarmDateHeader {
      width: 110px;
    }
    th#usageCycleHeader,
    th#deleteHeader,
    th#recommendHearder {
      width: 100px;
    }

    td {
      padding: 10px; /* ê° td ìš”ì†Œì˜ ë‚´ë¶€ ì—¬ë°± */
      border: 1px solid #ccc; /* ì…€ ê²½ê³„ì„  */
      text-align: center; /* í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ */
    }
  </style>
</head>
<body>
<div class="enterMap">
  <input type="text" id="locationInput" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" />
  <button onclick="searchLocation()">ì°¿ê¸°</button>
  <div id="distanceDisplay" style="display: inline-block">ê±°ë¦¬: 0 km</div>
  <button id="clearPathButton">ì´ì „ ë£¨íŠ¸</button>
  <button id="savePathButton">ë£¨íŠ¸ ì €ì¥</button>
  <button id="loadPathButton">ë£¨íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
</div>
<div class="WalkingTrail" id="walkingTrailMap"></div>
<div class="WalkingSchedule">
  <table id="WalkingTable">
    <thead>
    <tr>
      <th id="routeNameHeader">ì‚°ì±…ëª…<span class="sort-arrow" id="routeNameArrow"></span></th>
      <th id="routeLocationHeader">ì‚°ì±… ì§€ì—­<span class="sort-arrow" id="routeLocationArrow"></span></th>
      <th id="purchaseDateHeader">ì‚°ì±… ë‚ ì§œ<span class="sort-arrow" id="purchaseDateArrow">â–²</span></th>
      <th id="purchaseTimeHeader">ì‚°ì±… ì‹œê°„<span class="sort-arrow" id="purchaseTimeArrow"></span></th>
      <th id="routedistanceHeader">ì‚°ì±… ê±°ë¦¬<span class="sort-arrow" id="routedistanceArrow"></span></th>
      <th id="modifyHeader">ìˆ˜ì •</th>
      <th id="deleteHeader">ì‚­ì œ</th>
      <th id="recommendHearder">ì¶”ì²œ</th>
    </tr>
    </thead>
    <tbody>
    <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. -->
    </tbody>
  </table>
</div>
<div class="information"></div>

<div id="addRoutePopup" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" id="closeRoutePopup">&times;</span>
    <h2>ì‚°ì±… ì¼ì • ê´€ë¦¬</h2>

    <!-- ì‚°ì±… ì‹œê°„ ì…ë ¥ -->
    <label for="routeName">ì‚°ì±…ëª…</label>
    <input type="text" id="routeName" class="tw-border-box tw-w-[190px] tw-text-center tw-rounded-[5px] tw-border" /><br/><br/>

    <!-- ì¼ì • ë‚ ì§œ ì…ë ¥-->
    <label for="scheduleDate">ì‚°ì±… ë‚ ì§œ ì„ íƒ</label>
    <input type="date" id="scheduleDate" class="tw-border-box tw-w-[190px] tw-text-center tw-rounded-[5px] tw-border" /><br/><br/>

    <!-- ì‚°ì±… ì‹œê°„ ì…ë ¥ -->
    <label for="scheduleTime">ì‚°ì±… ì‹œê°„ ì„ íƒ</label>
    <input type="time" id="scheduleTime" class="tw-border-box tw-w-[190px] tw-text-center tw-rounded-[5px] tw-border" /> ~
    <input type="time" id="scheduleTime1" class="tw-border-box tw-w-[190px] tw-text-center tw-rounded-[5px] tw-border" /><br/><br/>

    <!-- ì‚°ì±… ë£¨íŠ¸ -->
    <label for="routePicture">ì‚°ì±… ë£¨íŠ¸</label>
    <br>
    <span id="routePicture" style="display: inline-block; width: 400px; height: 300px;">
      <div class="WalkingTrail" id="walkingTrailMap1" style=" width: 500px; height: 300px; bottom:120px;"></div>
    </span><br/><br/>

    <!-- ì‚°ì±… ê±°ë¦¬ -->
    <label for="routedistance">ì‚°ì±… ê±°ë¦¬</label>
    <span id="routedistance" style="display: inline-block;"></span><br/><br/>

    <!-- ì‚°ì±… ì§€ì—­ -->
    <label for="routeLocation">ì‚°ì±… ì§€ì—­</label>
    <span id="routeLocation" style="display: inline-block;"></span><br/><br/>

    <!-- ë²„íŠ¼ë“¤ -->
    <button id="createScheduleBtn">ì¼ì • ìƒì„±</button>
    <button id="updateScheduleBtn">ì¼ì • ìˆ˜ì •</button>
  </div>
</div>

<script>
  let map;
  let marker;
  let polyline; // Polyline ê°ì²´ ì¶”ê°€
  let path = []; // ê²½ë¡œë¥¼ ì €ì¥í•  ë°°ì—´
  let walks = []; // ì „ì—­ ë³€ìˆ˜ë¡œ walks ì •ì˜
  let currentSortColumn = ''; // í˜„ì¬ ì •ë ¬ëœ ì—´ì„ ì¶”ì í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
  let isAscending = true; // ì •ë ¬ ë°©í–¥ì„ ì¶”ì í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
  let wmemberId = [[${member.id}]];
  var RE = 6371.00877; // ì§€êµ¬ ë°˜ê²½(km)
  var GRID = 5.0; // ê²©ì ê°„ê²©(km)
  var SLAT1 = 30.0; // íˆ¬ì˜ ìœ„ë„1(degree)
  var SLAT2 = 60.0; // íˆ¬ì˜ ìœ„ë„2(degree)
  var OLON = 126.0; // ê¸°ì¤€ì  ê²½ë„(degree)
  var OLAT = 38.0; // ê¸°ì¤€ì  ìœ„ë„(degree)
  var XO = 43; // ê¸°ì¤€ì  Xì¢Œí‘œ(GRID)
  var YO = 136; // ê¸°ì¤€ì  Yì¢Œí‘œ(GRID)

  function dfs_xy_conv(code, v1, v2) {
    var DEGRAD = Math.PI / 180.0;
    var RADDEG = 180.0 / Math.PI;

    var re = RE / GRID;
    var slat1 = SLAT1 * DEGRAD;
    var slat2 = SLAT2 * DEGRAD;
    var olon = OLON * DEGRAD;
    var olat = OLAT * DEGRAD;

    var sn = Math.tan(Math.PI * 0.25 + slat2 * 0.5) / Math.tan(Math.PI * 0.25 + slat1 * 0.5);
    sn = Math.log(Math.cos(slat1) / Math.cos(slat2)) / Math.log(sn);
    var sf = Math.tan(Math.PI * 0.25 + slat1 * 0.5);
    sf = Math.pow(sf, sn) * Math.cos(slat1) / sn;
    var ro = Math.tan(Math.PI * 0.25 + olat * 0.5);
    ro = re * sf / Math.pow(ro, sn);

    var rs = {};
    if (code == "toXY") {
      rs['lat'] = v1; // ìœ„ë„
      rs['lng'] = v2; // ê²½ë„
      var ra = Math.tan(Math.PI * 0.25 + (v1) * DEGRAD * 0.5);
      ra = re * sf / Math.pow(ra, sn);
      var theta = v2 * DEGRAD - olon;
      if (theta > Math.PI) theta -= 2.0 * Math.PI;
      if (theta < -Math.PI) theta += 2.0 * Math.PI;
      theta *= sn;
      rs['x'] = Math.floor(ra * Math.sin(theta) + XO + 0.5);
      rs['y'] = Math.floor(ro - ra * Math.cos(theta) + YO + 0.5);
    } else {
      rs['x'] = v1; // Xì¢Œí‘œ
      rs['y'] = v2; // Yì¢Œí‘œ
      var xn = v1 - XO;
      var yn = ro - v2 + YO;
      ra = Math.sqrt(xn * xn + yn * yn);
      if (sn < 0.0) ra = -ra;
      var alat = Math.pow((re * sf / ra), (1.0 / sn));
      alat = 2.0 * Math.atan(alat) - Math.PI * 0.5;

      if (Math.abs(xn) <= 0.0) {
        theta = 0.0;
      } else {
        if (Math.abs(yn) <= 0.0) {
          theta = Math.PI * 0.5;
          if (xn < 0.0) theta = -theta;
        } else {
          theta = Math.atan2(xn, yn);
        }
      }
      var alon = theta / sn + olon;
      rs['lat'] = alat * RADDEG; // ë³€í™˜ëœ ìœ„ë„
      rs['lng'] = alon * RADDEG; // ë³€í™˜ëœ ê²½ë„
    }
    return rs; // ê²°ê³¼ ë°˜í™˜
  }

  // ìœ„ê²½ë„ë¥¼ ê²©ì ì¢Œí‘œë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
  function convertLatLngToGrid(latitude, longitude) {
    var result = dfs_xy_conv("toXY", latitude, longitude);
    return {
      nx: String(result.x), // nxë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
      ny: String(result.y)  // nyë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
    };
  }
  function initMap() {
    const latitude = [[${gpsCheck.latitude}]];
    const longitude = [[${gpsCheck.longitude}]];
    const initialPosition = { lat: latitude, lng: longitude };
    map = new google.maps.Map(document.getElementById("walkingTrailMap"), {
      center: initialPosition,
      zoom: 15,
    });
    const map1 = new google.maps.Map(document.getElementById("walkingTrailMap1"), {
      center: initialPosition,
      zoom: 15,
    });
    marker = new google.maps.Marker({
      position: initialPosition,
      map: map, map1,
      title: "My location",
    });


    polyline1 = new google.maps.Polyline({
      path: path,
      geodesic: true,
      strokeColor: '#FF0000',
      icons: [{
        icon: {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
          scale: 3,
          strokeColor: '#0000FF',
        },
        offset: '100%',
        repeat: '200px' // í™”ì‚´í‘œë¥¼ ê²½ë¡œë¥¼ ë”°ë¼ 20px ê°„ê²©ìœ¼ë¡œ ë°˜ë³µ
      }],
    });

    polyline2 = new google.maps.Polyline({
      path: path,
      geodesic: true,
      strokeColor: '#FF0000',
      icons: [{
        icon: {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
          scale: 3,
          strokeColor: '#0000FF',
        },
        offset: '100%',
        repeat: '200px'
      }],
    });
    polyline1.setMap(map); // ì§€ë„ì— polyline ì¶”ê°€
    polyline2.setMap(map1);


// ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    google.maps.event.addListener(map, 'click', function(event) {
      // í´ë¦­í•œ ìœ„ì¹˜ì˜ ìœ„ë„ì™€ ê²½ë„ ê°€ì ¸ì˜¤ê¸°
      const latLng = event.latLng;

      // ê²½ë¡œ ë°°ì—´ì— ì¶”ê°€
      path.push({ lat: latLng.lat(), lng: latLng.lng() });

      // ìƒˆë¡œìš´ í¬ì¸íŠ¸ë¥¼ Polylineì— ì¶”ê°€
      polyline2.setPath(path);
    });
    function openPopup(isEditMode = false,routeName = '', scheduleDate = '', scheduleTime = '', scheduleTime1 = '') {

      if (!isEditMode) {
        document.getElementById("routeName").value = '';
        document.getElementById("scheduleDate").value = '';
        document.getElementById("scheduleTime").value = '';
        document.getElementById("scheduleTime1").value = '';
      } else {
        document.getElementById("routeName").value = routeName;
        document.getElementById("scheduleDate").value = scheduleDate;
        document.getElementById("scheduleTime").value = scheduleTime;
        document.getElementById("scheduleTime1").value = scheduleTime1;
      }

      // íŒì—… ì—´ê¸°
      document.getElementById("addRoutePopup").style.display = "block";

      if (isEditMode) {
        // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ
        document.getElementById("createScheduleBtn").style.display = "none"; // ì¼ì • ìƒì„± ë²„íŠ¼ ìˆ¨ê¹€
        document.getElementById("updateScheduleBtn").style.display = "block"; // ì¼ì • ìˆ˜ì • ë²„íŠ¼ ë³´ì„
      } else {
        // ìƒì„± ëª¨ë“œì¼ ë•Œ
        document.getElementById("createScheduleBtn").style.display = "block"; // ì¼ì • ìƒì„± ë²„íŠ¼ ë³´ì„
        document.getElementById("updateScheduleBtn").style.display = "none"; // ì¼ì • ìˆ˜ì • ë²„íŠ¼ ìˆ¨ê¹€
      }
    }

    document.getElementById("createScheduleBtn").addEventListener("click", function() {
      // ì…ë ¥ í•„ë“œì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
      const routeName = document.getElementById("routeName").value;
      const scheduleDate = document.getElementById("scheduleDate").value;
      const scheduleTime = document.getElementById("scheduleTime").value;
      const scheduleTime1 = document.getElementById("scheduleTime1").value;

      // ê²½ë¡œ ê±°ë¦¬ì™€ ì§€ì—­ ì •ë³´ëŠ” IDë‚˜ í´ë˜ìŠ¤ ë“±ì„ í†µí•´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      const routedistanceText = document.getElementById("routedistance").textContent; // "2.5 km"
      const routedistance = parseFloat(routedistanceText.match(/[0-9.]+/)[0]);
      const routeLocation = document.getElementById("routeLocation").textContent; // ì˜ˆ: "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬"

      const data = JSON.stringify({ path: path });

      // ìƒˆë¡œìš´ Walk ê°ì²´ ìƒì„±
      const walkData = {
        memberId: wmemberId,
        routeName: routeName,
        purchaseDate: scheduleDate,
        purchaseTime: `${scheduleTime} ~ ${scheduleTime1}`, // ì‹œê°„ í˜•ì‹ ì§€ì •
        routePicture: data,
        routedistance: routedistance, // ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
        location: routeLocation
      };
      console.log(walkData);

      // AJAX ìš”ì²­ì„ ë³´ë‚´ê¸°
      fetch('/usr/walk/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(walkData) // Walk ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
      })
              .then(response => {
                if (response.ok) {
                  return response.text(); // ì„±ê³µì ì¸ ì‘ë‹µ
                }
                throw new Error('Network response was not ok.');
              })
              .then(data => {
                console.log('ì„±ê³µ:', data); // ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
                window.location.reload();
                document.getElementById("addRoutePopup").style.display = "none"; // íŒì—… ë‹«ê¸°
              })
              .catch((error) => {
                console.error('ì‹¤íŒ¨:', error); // ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥
                alert('ì¼ì • ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
              });
    });
    document.addEventListener("DOMContentLoaded", function() {
      fetchWalks(wmemberId);
    });
    function renderWalks(walksData) {
      const tableBody = document.querySelector("#WalkingTable tbody");
      tableBody.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš©ì„ ì§€ì›ë‹ˆë‹¤.

      walksData.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td class="ellipsis">${item.routeName}</td>
            <td>${item.location}</td>
            <td>${item.purchaseDate}</td>
            <td>${item.purchaseTime}</td>
            <td>${item.routedistance}</td>
            <td>
            <button class="modify-btn"
                        data-route-name="${item.routeName}"
                        data-location="${item.location}"
                        data-purchase-date="${item.purchaseDate}"
                        data-purchase-time="${item.purchaseTime}"
                        data-route-distance="${item.routedistance}">ğŸ”§</button></td>
            <td>
            <button class="delete-btn"
                        data-route-name="${item.routeName}"
                        data-location="${item.location}"
                        data-purchase-date="${item.purchaseDate}"
                        data-purchase-time="${item.purchaseTime}"
                        data-route-distance="${item.routedistance}">ğŸ—‘</button></td>
            <td><button class="article-btn"
                        data-route-name="${item.routeName}"
                        data-location="${item.location}"
                        data-purchase-date="${item.purchaseDate}"
                        data-purchase-time="${item.purchaseTime}"
                        data-route-distance="${item.routedistance}>ğŸ‘</button></td>
        `;

        tableBody.appendChild(row);
      });



      const modifyButtons = document.querySelectorAll(".modify-btn");
      modifyButtons.forEach(button => {
        button.addEventListener("click", function (event) {
          event.stopPropagation();
          // ë²„íŠ¼ì— ì„¤ì •ëœ ë°ì´í„° ì†ì„±ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
          const routeName = this.getAttribute("data-route-name");
          const purchaseDate = this.getAttribute("data-purchase-date");
          const purchaseTime = this.getAttribute("data-purchase-time");

          // purchaseTimeì—ì„œ ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì„ êµ¬ë¶„í•˜ì—¬ scheduleTimeê³¼ scheduleTime1ì— ë„£ê¸°
          const [scheduleTime, scheduleTime1] = purchaseTime.split(' ~ ');

          // ìˆ˜ì • ëª¨ë“œë¡œ íŒì—… ì—´ê¸°
          openPopup(true, routeName, purchaseDate, scheduleTime, scheduleTime1);
        });
      });

      // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
      const deleteButtons = document.querySelectorAll(".delete-btn");
      deleteButtons.forEach(button => {
        button.addEventListener("click", function (event) {
          event.stopPropagation(); // ë¶€ëª¨ ìš”ì†Œì˜ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë°©ì§€
          const routeName = this.getAttribute("data-route-name");
          const location = this.getAttribute("data-location");
          const purchaseDate = this.getAttribute("data-purchase-date");
          const purchaseTime = this.getAttribute("data-purchase-time");
          const routedistance = this.getAttribute("data-route-distance");

          // ì•Œë¦¼ì°½ í‘œì‹œ
          const confirmDelete = confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");

          if (confirmDelete) {
            // ì‚¬ìš©ìê°€ "ì˜ˆ"ë¥¼ ì„ íƒí–ˆì„ ë•Œë§Œ ì‚­ì œ í•¨ìˆ˜ í˜¸ì¶œ
            deleteWalk(routeName, location, purchaseDate, purchaseTime,routedistance);
          } else {
            // ì‚¬ìš©ìê°€ "ì•„ë‹ˆì˜¤"ë¥¼ ì„ íƒí–ˆì„ ë•ŒëŠ” ì‚­ì œ ì·¨ì†Œ
            console.log("ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          }
        });
      });
      // ì¶”ì²œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
      const articleButtons = document.querySelectorAll(".article-btn");
      articleButtons.forEach(button => {
        button.addEventListener("click", function (event) {
          event.stopPropagation(); // ë¶€ëª¨ ìš”ì†Œì˜ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë°©ì§€
          const routeName = this.getAttribute("data-route-name");
          const location = this.getAttribute("data-location");
          const purchaseDate = this.getAttribute("data-purchase-date");
          const purchaseTime = this.getAttribute("data-purchase-time");
          const routedistance = this.getAttribute("data-route-distance");
          const routePicture = JSON.parse(decodeURIComponent(this.getAttribute("data-route-picture")));

          if (!confirm("ì •ë§ë¡œ ì¶”ì²œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            return; // ì‚¬ìš©ìê°€ "ì•„ë‹ˆì˜¤"ë¥¼ ì„ íƒí•œ ê²½ìš° í•¨ìˆ˜ ì¢…ë£Œ
          }
          // WYSIWYG ë°©ì‹ìœ¼ë¡œ HTML ì½˜í…ì¸  ìƒì„±
          const contentContainer = document.createElement('div');

          const mapElement = document.createElement('div');
          mapElement.textContent = routePicture;

          const routeNameElement = document.createElement('div');
          routeNameElement.textContent = `ì‚°ì±…ëª… : ` + routeName;

          const routeLocationElement = document.createElement('div');
          routeLocationElement.textContent = `ì§€ì—­ : ` + location;

          const routedistanceElement = document.createElement('div');
          routedistanceElement.textContent = `ì‚°ì±…ê±°ë¦¬ : ` + routedistance;

          // ìš”ì†Œë“¤ì„ contentContainerì— ì¶”ê°€
          contentContainer.appendChild(routeNameElement);
          contentContainer.appendChild(document.createElement('br'));
          contentContainer.appendChild(mapElement);
          contentContainer.appendChild(document.createElement('br'));
          contentContainer.appendChild(routeLocationElement);
          contentContainer.appendChild(document.createElement('br'));
          contentContainer.appendChild(routedistanceElement);

          // HTML ì½˜í…ì¸ ë¥¼ ì¸ì½”ë”©
          const encodedContent = encodeURIComponent(contentContainer.innerHTML);

          // í˜ì´ì§€ë¥¼ initializeEditorê°€ ìˆëŠ” HTML íŒŒì¼ë¡œ ì´ë™
          window.location.href = `http://localhost:8081/usr/shopping/write?content=${encodedContent}`;
        });
      });
    }
    function deleteWalk(routeName, location, purchaseDate, purchaseTime,routedistance) {
      let eventIdToDelete;

      if (!routeName) {
        alert("ì•„ì´í…œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      // memberIdë¥¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€í•˜ì—¬ ê¸°ì¡´ ì¼ì • ê°€ì ¸ì˜¤ê¸°
      fetch(`/usr/walk/get?memberId=` + wmemberId)
              .then(response => response.json())
              .then(data => {
                // íŠ¹ì • ì´ë²¤íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•œ ë¡œì§
                data.forEach(event => {
                  console.log(event.routedistance);
                  console.log(parseFloat(routedistance));
                  if (event.routeName === routeName &&
                          event.location === location &&
                          event.purchaseDate === purchaseDate &&
                          event.purchaseTime === purchaseTime &&
                          event.routedistance === parseFloat(routedistance)) {
                    eventIdToDelete = event.id; // í•´ë‹¹ IDë¥¼ ì €ì¥
                  }
                });
                // ì‚­ì œí•  ì´ë²¤íŠ¸ IDê°€ ì¡´ì¬í•˜ë©´ ì‚­ì œ ìš”ì²­
                if (eventIdToDelete) {
                  // DELETE ë©”ì†Œë“œë¡œ ìš”ì²­ ë³´ë‚´ê¸°
                  fetch(`/usr/walk/delete?id=` + eventIdToDelete, {
                    method: 'DELETE'
                  })
                          .then(response => {
                            if (!response.ok) {
                              throw new Error('ì‚­ì œ ìš”ì²­ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            }
                            return response.json(); // ì‘ë‹µì„ JSONìœ¼ë¡œ ì²˜ë¦¬
                          })
                          .then(data => {
                            console.log('ì‚­ì œ ì„±ê³µ:', data.message);
                            window.location.reload();
                          })
                          .catch(error => {
                            console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
                          });
                } else {
                  alert("í•´ë‹¹ ì¼ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
              })
              .catch(error => {
                console.error('ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
              });
    }

    function sortByColumn(walksData, column, isAscending) {
      return walksData.sort((a, b) => {
        let valueA = a[column] || '';  // undefined ì²˜ë¦¬
        let valueB = b[column] || '';

        // 'timing' ê°’ì„ ì´ìš©í•˜ì—¬ ì•ŒëŒì¼ ê³„ì‚°
        if (column === 'alarmDays') {
          const today = new Date();
          const alarmDateA = new Date(today);
          alarmDateA.setDate(today.getDate() - a.timing);  // aì˜ timingì„ ì‚¬ìš©í•˜ì—¬ ì•ŒëŒì¼ ê³„ì‚°

          const alarmDateB = new Date(today);
          alarmDateB.setDate(today.getDate() - b.timing);  // bì˜ timingì„ ì‚¬ìš©í•˜ì—¬ ì•ŒëŒì¼ ê³„ì‚°

          valueA = alarmDateA;
          valueB = alarmDateB;
        }

        // ë‚ ì§œ í˜•ì‹ì¼ ê²½ìš° ë¹„êµ ë°©ë²• ë³€ê²½
        if (column === 'purchaseDate') {
          valueA = valueA ? new Date(valueA) : new Date();
          valueB = valueB ? new Date(valueB) : new Date();
        }

        // ì •ë ¬ ë¡œì§ (ì˜¤ë¦„ì°¨ìˆœ ë˜ëŠ” ë‚´ë¦¼ì°¨ìˆœ)
        if (valueA < valueB) return isAscending ? -1 : 1;
        if (valueA > valueB) return isAscending ? 1 : -1;
        return 0;
      });
    }
    currentSortColumn = 'purchaseDate'; // ì´ˆê¸° ì •ë ¬ ì—´

    const arrows = {
      routeName: document.getElementById("routeNameArrow"),
      routeLocation: document.getElementById("routeLocationArrow"),
      purchaseDate: document.getElementById("purchaseDateArrow"),
      purchaseTime: document.getElementById("purchaseTimeArrow"),
      routedistance: document.getElementById("routedistanceArrow"),
    };

// í™”ì‚´í‘œ ì´ˆê¸°í™” í•¨ìˆ˜
    function resetArrows() {
      for (const key in arrows) {
        arrows[key].textContent = ''; // ëª¨ë“  í™”ì‚´í‘œ ì´ˆê¸°í™”
        arrows[key].classList.remove('visible');
      }
    }

// ì´ˆê¸°í™” í•¨ìˆ˜
    function init() {
      resetArrows(); // í™”ì‚´í‘œ ì´ˆê¸°í™”
      arrows.purchaseDate.textContent = 'â–¼'; // êµ¬ë§¤ì¼ í™”ì‚´í‘œ í‘œì‹œ
      arrows.purchaseDate.classList.add('visible'); // í™”ì‚´í‘œ ë³´ì´ê¸°
      const sortedWalks = sortByColumn(walks, currentSortColumn, isAscending); // ì •ë ¬
      renderWalks(sortedWalks); // ì •ë ¬ëœ ë°ì´í„° ë Œë”ë§
    }

    init(); // ì´ˆê¸°í™” í˜¸ì¶œ

// ì‚°ì±…ëª… ì •ë ¬
    document.getElementById("routeNameHeader").addEventListener("click", () => {
      resetArrows(); // í™”ì‚´í‘œ ì´ˆê¸°í™”
      isAscending = currentSortColumn !== 'routeName' || !isAscending; // ì •ë ¬ ë°©í–¥ ê²°ì •
      currentSortColumn = 'routeName';
      arrows.routeName.textContent = isAscending ? 'â–¼' : 'â–²'; // í™”ì‚´í‘œ í‘œì‹œ
      arrows.routeName.classList.add('visible'); // í™”ì‚´í‘œ ë³´ì´ê¸°
      const sortedWalks = sortByColumn(walks, 'routeName', isAscending); // ì •ë ¬
      renderWalks(sortedWalks); // ì •ë ¬ëœ ë°ì´í„° ë Œë”ë§
    });

// ì‚°ì±… ì§€ì—­ ì •ë ¬
    document.getElementById("routeLocationHeader").addEventListener("click", () => {
      resetArrows(); // í™”ì‚´í‘œ ì´ˆê¸°í™”
      isAscending = currentSortColumn !== 'routeLocation' || !isAscending; // ì •ë ¬ ë°©í–¥ ê²°ì •
      currentSortColumn = 'routeLocation';
      arrows.routeLocation.textContent = isAscending ? 'â–¼' : 'â–²'; // í™”ì‚´í‘œ í‘œì‹œ
      arrows.routeLocation.classList.add('visible'); // í™”ì‚´í‘œ ë³´ì´ê¸°
      const sortedWalks = sortByColumn(walks, 'routeLocation', isAscending); // ì •ë ¬
      renderWalks(sortedWalks); // ì •ë ¬ëœ ë°ì´í„° ë Œë”ë§
    });

// ì‚°ì±…ë‚ ì§œ ì •ë ¬
    document.getElementById("purchaseDateHeader").addEventListener("click", () => {
      resetArrows(); // í™”ì‚´í‘œ ì´ˆê¸°í™”
      isAscending = currentSortColumn !== 'purchaseDate' || !isAscending; // ì •ë ¬ ë°©í–¥ ê²°ì •
      currentSortColumn = 'purchaseDate';
      arrows.purchaseDate.textContent = isAscending ? 'â–¼' : 'â–²'; // í™”ì‚´í‘œ í‘œì‹œ
      arrows.purchaseDate.classList.add('visible'); // í™”ì‚´í‘œ ë³´ì´ê¸°
      const sortedWalks = sortByColumn(walks, 'purchaseDate', isAscending); // ì •ë ¬
      renderWalks(sortedWalks); // ì •ë ¬ëœ ë°ì´í„° ë Œë”ë§
    });

// ì‚°ì±…ì‹œê°„ ì •ë ¬
    document.getElementById("purchaseTimeHeader").addEventListener("click", () => {
      resetArrows(); // í™”ì‚´í‘œ ì´ˆê¸°í™”
      isAscending = currentSortColumn !== 'purchaseTime' || !isAscending; // ì •ë ¬ ë°©í–¥ ê²°ì •
      currentSortColumn = 'purchaseTime';
      arrows.purchaseTime.textContent = isAscending ? 'â–¼' : 'â–²'; // í™”ì‚´í‘œ í‘œì‹œ
      arrows.purchaseTime.classList.add('visible'); // í™”ì‚´í‘œ ë³´ì´ê¸°
      const sortedWalks = sortByColumn(walks, 'purchaseTime', isAscending); // ì •ë ¬
      renderWalks(sortedWalks); // ì •ë ¬ëœ ë°ì´í„° ë Œë”ë§
    });

// ì‚°ì±…ê±°ë¦¬ ì •ë ¬
    document.getElementById("routedistanceHeader").addEventListener("click", () => {
      resetArrows(); // í™”ì‚´í‘œ ì´ˆê¸°í™”
      isAscending = currentSortColumn !== 'routedistance' || !isAscending; // ì •ë ¬ ë°©í–¥ ê²°ì •
      currentSortColumn = 'routedistance';
      arrows.routedistance.textContent = isAscending ? 'â–¼' : 'â–²'; // í™”ì‚´í‘œ í‘œì‹œ
      arrows.routedistance.classList.add('visible'); // í™”ì‚´í‘œ ë³´ì´ê¸°
      const sortedWalks = sortByColumn(walks, 'routedistance', isAscending); // ì •ë ¬
      renderWalks(sortedWalks); // ì •ë ¬ëœ ë°ì´í„° ë Œë”ë§
    });

// í’ˆëª© ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    function fetchWalks(wmemberId) {
      fetch(`/usr/walk/get?memberId=`+wmemberId) // memberId ê°’ì„ URLì— ì¶”ê°€
              .then(response => {
                if (!response.ok) {
                  throw new Error('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
              })
              .then(data => {
                walks = data; // ë°ì´í„°ë¥¼ essentialsì— í• ë‹¹

                // ê¸°ë³¸ì ìœ¼ë¡œ êµ¬ë§¤ì¼ ìˆœìœ¼ë¡œ ì •ë ¬
                walks = sortByColumn(walks, 'purchaseDate', true); // ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
                renderWalks(walks); // ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
              })
              .catch(error => {
                console.error('Error fetching essentials:', error);
              });
    }
    // ì´ˆê¸° ìœ„ì¹˜ì— ëŒ€í•œ ê²©ì ì¢Œí‘œ ìš”ì²­
    const gridCoordinates = convertLatLngToGrid(latitude, longitude);
    getWeatherInfo(gridCoordinates.nx, gridCoordinates.ny); // ë‚ ì”¨ ì •ë³´ ìš”ì²­

    // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    map.addListener('click', (event) => {
      addLatLng(event.latLng);
    });

    // ê²½ë¡œ ì§€ìš°ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById("clearPathButton").addEventListener("click", clearPath);
    document.getElementById("savePathButton").addEventListener("click", function() {
      openPopup(false);
      document.getElementById("routedistance").innerText = document.getElementById("distanceDisplay").innerText.replace("ì´ ê±°ë¦¬: ", "");
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ location: marker.getPosition() }, function(results, status) {
        if (status === "OK") {
          if (results[0]) {
            const addressWords = results[0].formatted_address.split(" ");
            document.getElementById("routeLocation").innerText = addressWords[1] || "ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
          } else {
            document.getElementById("routeLocation").innerText = "ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
          }
        } else {
          console.error("Geocoder failed due to: " + status);
          document.getElementById("routeLocation").innerText = "ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
        }
      });
    });
    document.getElementById("closeRoutePopup").addEventListener("click", function() {
      document.getElementById("addRoutePopup").style.display = "none";
    });
    document.getElementById("loadPathButton").addEventListener("click", loadPathFromLocalStorage);
  }

  // í´ë¦­ëœ ìœ„ì¹˜ë¥¼ polyline ê²½ë¡œì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
  function addLatLng(location) {
    path.push(location);
    polyline1.setPath(path);
    polyline2.setPath(path);
    updateDistance(); // ê²½ë¡œê°€ ì—…ë°ì´íŠ¸ë  ë•Œë§ˆë‹¤ ê±°ë¦¬ ê³„ì‚°
  }

  function updateDistance() {
    let totalDistance = 0;

    // ë‘ ì¢Œí‘œ ê°„ì˜ ê±°ë¦¬ ê³„ì‚° ë° í•©ì‚°
    for (let i = 0; i < path.length - 1; i++) {
      totalDistance += google.maps.geometry.spherical.computeDistanceBetween(path[i], path[i + 1]);
    }

    // ê±°ë¦¬ í‘œì‹œ (ë¯¸í„°ë¥¼ í‚¬ë¡œë¯¸í„°ë¡œ ë³€í™˜)
    const distanceInKm = (totalDistance / 1000).toFixed(2);
    document.getElementById("distanceDisplay").innerText = `ì´ ê±°ë¦¬: ${distanceInKm} km`;
  }

  // ê²½ë¡œë¥¼ ì§€ìš°ëŠ” í•¨ìˆ˜
  function clearPath() {
    if (path.length > 0) {
      path.pop(); // ë§ˆì§€ë§‰ ì¢Œí‘œ ì œê±°
      polyline1.setPath(path); // í´ë¦¬ë¼ì¸ì— ìƒˆë¡œìš´ ê²½ë¡œ ì„¤ì •
      polyline2.setPath(path);
      updateDistance();
    }
  }
  function savePathToLocalStorage() {
    const pathCoordinates = path.map(point => ({ lat: point.lat(), lng: point.lng() }));
    localStorage.setItem("savedPath", JSON.stringify(pathCoordinates));
    alert("Path saved successfully!");
  }

  function loadPathFromLocalStorage() {
    const savedPath = JSON.parse(localStorage.getItem("savedPath"));
    if (savedPath && savedPath.length > 0) {
      path = savedPath.map(coord => new google.maps.LatLng(coord.lat, coord.lng));
      polyline1.setPath(path);
      polyline2.setPath(path);
      updateDistance(); // ë¡œë“œëœ ê²½ë¡œì˜ ê±°ë¦¬ ì—…ë°ì´íŠ¸
    } else {
      alert("No path found in local storage.");
    }
  }

  // ìœ„ì¹˜ ì…ë ¥ í•„ë“œì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  document.getElementById("locationInput").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
      searchLocation();
    }
  });


  function searchLocation() {
    const location = document.getElementById("locationInput").value;
    if (!location) {
      alert("Please enter a location.");
      return;
    }

    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({ address: location }, (results, status) => {
      if (status === "OK" && results[0]) {
        const position = results[0].geometry.location;
        map.setCenter(position);
        map.setZoom(15);
        marker.setPosition(position);
        marker.setTitle(location);

        // ì˜ˆì‹œ ì‚¬ìš©
        const latitude = position.lat(); // ì‹¤ì œ ìœ„ì¹˜ê°’
        const longitude = position.lng(); // ì‹¤ì œ ìœ„ì¹˜ê°’
        var gridCoordinates = convertLatLngToGrid(latitude, longitude);
        getWeatherInfo(gridCoordinates.nx, gridCoordinates.ny); // ë‚ ì”¨ ì •ë³´ ìš”ì²­
      } else {
        alert("Geocode was not successful for the following reason: " + status);
      }
    });
  }
  function getCurrentDate() {
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0'); // ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
    const day = String(today.getDate()).padStart(2, '0');

    return `${year}${month}${day}`;
  }
  function getCurrentHour() {
    const today = new Date();
    const hours = today.getHours(); // í˜„ì¬ ì‹œê°„ (0-23)
    const minutes = today.getMinutes(); // í˜„ì¬ ë¶„ (0-59)

    // í˜„ì¬ ì‹œê°„ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì €ì¥í•  ë³€ìˆ˜
    let adjustedHour;

    // ë¶„ì´ 10ë¶„ ë¯¸ë§Œì´ë©´ ì „ì‹œê°„ìœ¼ë¡œ ì„¤ì •
    if (minutes < 10) {
      adjustedHour = hours > 0 ? hours - 1 : 23; // 0ì‹œì¸ ê²½ìš° 23ì‹œë¡œ ì„¤ì •
    } else {
      adjustedHour = hours; // 10ë¶„ ì´ìƒì´ë©´ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
    }

    // 2ìë¦¬ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
    return String(adjustedHour).padStart(2, '0') + "00"; // ì˜ˆ: "0700", "0800"
  }

  function getWeatherInfo(nx, ny) {
    // í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
    const date = getCurrentDate();
    const hour = getCurrentHour();

    // AJAX ìš”ì²­ì„ í†µí•´ ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    fetch(`/usr/walk/getWeather?date=${date}&hour=${hour}&nx=${nx}&ny=${ny}`)
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
              }
              return response.json(); // JSON í˜•íƒœë¡œ ì‘ë‹µì„ ê°€ì ¸ì˜¤ê¸°
            })
            .then(data => {
              // obsrValue ê°’ì„ ì €ì¥í•  ë³€ìˆ˜
              let obsrValuePTY, obsrValueRN1, obsrValueT1H;

              // items.item ë°°ì—´ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ìˆœíšŒ
              const items = data.response.body.items.item; // item ë°°ì—´ ê°€ì ¸ì˜¤ê¸°
              if (Array.isArray(items)) {
                items.forEach(item => {
                  const category = item.category; // category ê°’ì„ ê°€ì ¸ì˜´
                  const obsrValue = item.obsrValue; // obsrValue ê°’ì„ ê°€ì ¸ì˜´

                  // categoryì— ë”°ë¼ obsrValue ê°’ í• ë‹¹
                  if (category === "PTY") {
                    obsrValuePTY = obsrValue;
                  } else if (category === "RN1") {
                    obsrValueRN1 = obsrValue;
                  } else if (category === "T1H") {
                    obsrValueT1H = obsrValue;
                  }
                });
              }

              // obsrValuePTYì— ë”°ë¼ ì•„ì´ì½˜ ê²°ì •
              const weatherIcon = {
                "0": "ğŸŒ",  // ë§‘ìŒ
                "1": "ğŸŒ§",  // ë¹„
                "2": "ğŸŒ§/ğŸŒ¨", // ë¹„/ëˆˆ
                "3": "ğŸŒ¨",  // ëˆˆ
                "4": "â›ˆ",  // ì²œë‘¥ë²ˆê°œ
              };

              // PTYì— ë”°ë¥¸ ë‚ ì”¨ ì•„ì´ì½˜ ì¶œë ¥
              const weatherSymbol = weatherIcon[obsrValuePTY] || "â“"; // ê¸°ë³¸ ì•„ì´ì½˜
              const weatherSymbolElement = document.querySelector(".information"); // ë‚ ì”¨ ì•„ì´ì½˜ì„ í‘œì‹œí•  ìš”ì†Œ

              // "ì´ ì§€ì—­ì˜ ë‚ ì”¨" ë©˜íŠ¸ë¥¼ ì¶”ê°€í•˜ê³  ì•„ì´ì½˜ì„ ë‹¤ìŒ ì¤„ì— í‘œì‹œ
              weatherSymbolElement.innerHTML = `ì´ ì§€ì—­ì˜ ë‚ ì”¨<br><span style="font-size: 1.5em;">${weatherSymbol}</span`; // í¬ê¸° ì¡°ì • ë° ì¤„ ë°”ê¿ˆ ì¶”ê°€

              // ê¸°ì˜¨ ì²˜ë¦¬ ë° í‘œì‹œ
              if (obsrValueT1H) {
                const temperature = `${obsrValueT1H}Â°C`; // ì„­ì”¨ ê¸°í˜¸ ë¶™ì´ê¸°
                const temperatureElement = document.createElement('div');
                temperatureElement.textContent = `ê¸°ì˜¨: ${temperature}`;
                weatherSymbolElement.appendChild(temperatureElement); // ë‚ ì”¨ ì•„ì´ì½˜ ì•„ë˜ì— ì¶”ê°€
              }

              // ê°•ìˆ˜ëŸ‰ ì²˜ë¦¬ ë° í‘œì‹œ
              if (obsrValueRN1 > 0) { // ê°•ìˆ˜ëŸ‰ì´ 0 ì´ìƒì¼ ë•Œë§Œ í‘œì‹œ
                const rainfall = `${obsrValueRN1}mm`; // ê°•ìˆ˜ëŸ‰ì— .mm ë¶™ì´ê¸°
                const rainfallElement = document.createElement('div');
                rainfallElement.textContent = `ê°•ìˆ˜ëŸ‰: ${rainfall}`;
                weatherSymbolElement.appendChild(rainfallElement); // ë‚ ì”¨ ì•„ì´ì½˜ ì•„ë˜ì— ì¶”ê°€
              }

            })
            .catch(error => {
              console.error('Error fetching weather data:', error);
            });
  }
</script>
</body>
</html>